{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment Summary</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

    <!-- Razorpay -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <style>
        body {
            background-color: #f4f7fb;
        }
        .payment-box {
            border-radius: 20px;
            background: white;
            padding: 25px;
        }
        .pay-option {
            border: 2px solid #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
            padding: 20px;
        }
        .pay-option:hover {
            border-color: #0d6efd;
            background: #f0f8ff;
        }
        .pay-option input {
            display: none;
        }
        .pay-option.active {
            border-color: #0d6efd;
            background: #e9f2ff;
        }
        .btn-pay {
            height: 55px;
            font-size: 20px;
            font-weight: bold;
        }
    </style>
</head>

<body>

<div class="container mt-4">
    <h2 class="text-center fw-bold">Payment Summary</h2>

    <div class="card payment-box shadow mt-3">

        <!-- Booking Details -->
        <h4 class="mb-3">Booking Details</h4>
        <p><strong>Name:</strong> {{ booking.fname }}</p>
        <p><strong>Date:</strong> {{ booking.event_date }}</p>
        <p><strong>Timing:</strong> {{ booking.timing }}</p>
        <p><strong>No. of People:</strong> {{ booking.no_of_people }}</p>

        <!-- Addons -->
        <h4 class="mt-4">Addons Selected</h4>
        <ul>
            {% for item in addons %}
                <li>{{ item.addon.name }} — ₹{{ item.addon.price }}</li>
            {% empty %}
                <li>No addons selected</li>
            {% endfor %}
        </ul>

        <!-- Total -->
        <h3 class="mt-4">
            Total Amount:
            <span class="text-success">₹{{ total_amount }}</span>
        </h3>

        <hr>

        <!-- Payment Options -->
        <h4 class="mt-3">Choose Payment Method</h4>

        <div class="row mt-3">

            <!-- Online Razorpay -->
            <div class="col-12 col-md-6 my-2">
                <label class="w-100">
                    <div class="pay-option text-center">
                        <input type="radio" name="payment_type" value="online">
                        <i class="fa-solid fa-credit-card fa-2x text-primary"></i><br>
                        <strong>Online Payment</strong><br>
                        <small>Card / UPI / NetBanking</small>
                    </div>
                </label>
            </div>

            <!-- COD -->
            <div class="col-12 col-md-6 my-2">
                <label class="w-100">
                    <div class="pay-option text-center">
                        <input type="radio" name="payment_type" value="cod">
                        <i class="fa-solid fa-money-bill fa-2x text-warning"></i><br>
                        <strong>Cash on Event</strong>
                    </div>
                </label>
            </div>

        </div>

        <!-- Pay Button -->
        <button class="btn btn-primary w-100 btn-pay mt-4"
                id="payNowBtn"
                data-booking-id="{{ booking.id }}">
            PAY NOW
        </button>

    </div>
</div>

<script>
    // UI Selection
    const options = document.querySelectorAll(".pay-option");
    options.forEach(opt => {
        opt.addEventListener("click", () => {
            options.forEach(o => o.classList.remove("active"));
            opt.classList.add("active");
            opt.querySelector("input").checked = true;
        });
    });

    document.getElementById("payNowBtn").onclick = function () {

        let selected = document.querySelector("input[name='payment_type']:checked");
        let bookingId = this.dataset.bookingId;

        if (!selected) {
            alert("Please select a payment method!");
            return;
        }

        // COD
        if (selected.value === "cod") {
            window.location.href = `/payment/cod/${bookingId}/`;
            return;
        }

        // Razorpay
        var options = {
            "key": "{{ razorpay_key }}",
            "amount": "{{ razorpay_amount }}",
            "currency": "INR",
            "name": "Event Booking",
            "description": "Booking Payment",
            "order_id": "{{ razorpay_order_id }}",

            "handler": function (response) {
                window.location.href =
                    "/payment/success/?" +
                    "payment_id=" + response.razorpay_payment_id +
                    "&order_id=" + response.razorpay_order_id +
                    "&signature=" + response.razorpay_signature;
            },

            "prefill": {
                "name": "{{ booking.fname }}",
                "email": "{{ booking.email|default:'' }}",
                "contact": "{{ booking.mobile|default:'' }}"
            },

            "theme": {
                "color": "#0d6efd"
            }
        };

        var rzp = new Razorpay(options);
        rzp.open();
    }
</script>

</body>
</html>
